kind: job
metadata:
  name: describe
  tag: ''
  hash: e8c44e41691adade69ca11c9af18477b3ea8d601
  project: ''
  labels:
    author: Davids
  categories:
  - data-analysis
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHdhcm5pbmdzCgp3YXJuaW5ncy5zaW1wbGVmaWx0ZXIoYWN0aW9uPSJpZ25vcmUiLCBjYXRlZ29yeT1GdXR1cmVXYXJuaW5nKQoKaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBwYW5kYXMgYXMgcGQKCmZyb20gbWxydW4uZXhlY3V0aW9uIGltcG9ydCBNTENsaWVudEN0eApmcm9tIG1scnVuLmRhdGFzdG9yZSBpbXBvcnQgRGF0YUl0ZW0KZnJvbSBtbHJ1bi5hcnRpZmFjdHMgaW1wb3J0IFRhYmxlQXJ0aWZhY3QsIFBsb3RseUFydGlmYWN0CmltcG9ydCBwbG90bHkuZmlndXJlX2ZhY3RvcnkgYXMgZmYKaW1wb3J0IHBsb3RseS5leHByZXNzIGFzIHB4CmltcG9ydCBwbG90bHkuZ3JhcGhfb2JqZWN0cyBhcyBnbwoKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QKCnBkLnNldF9vcHRpb24oImRpc3BsYXkuZmxvYXRfZm9ybWF0IiwgbGFtYmRhIHg6ICIlLjJmIiAlIHgpCgoKZGVmIHN1bW1hcml6ZSgKICAgICAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgICAgICB0YWJsZTogRGF0YUl0ZW0sCiAgICAgICAgbGFiZWxfY29sdW1uOiBzdHIgPSBOb25lLAogICAgICAgIGNsYXNzX2xhYmVsczogTGlzdFtzdHJdID0gW10sCiAgICAgICAgcGxvdF9oaXN0OiBib29sID0gVHJ1ZSwKICAgICAgICBwbG90c19kZXN0OiBzdHIgPSAicGxvdHMiLAogICAgICAgIHVwZGF0ZV9kYXRhc2V0PUZhbHNlLAogICAgICAgIGZyYWM6IGZsb2F0ID0gMC4xMAopIC0+IE5vbmU6CiAgICAiIiJTdW1tYXJpemUgYSB0YWJsZQoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gdGFibGU6ICAgICAgICAgICBNTFJ1biBpbnB1dCBwb2ludGluZyB0byBwYW5kYXMgZGF0YWZyYW1lIChjc3YvcGFycXVldCBmaWxlIHBhdGgpCiAgICA6cGFyYW0gbGFiZWxfY29sdW1uOiAgICBncm91bmQgdHJ1dGggY29sdW1uIGxhYmVsCiAgICA6cGFyYW0gY2xhc3NfbGFiZWxzOiAgICBsYWJlbCBmb3IgZWFjaCBjbGFzcyBpbiB0YWJsZXMgYW5kIHBsb3RzCiAgICA6cGFyYW0gcGxvdF9oaXN0OiAgICAgICAoVHJ1ZSkgc2V0IHRoaXMgdG8gRmFsc2UgZm9yIGxhcmdlIHRhYmxlcwogICAgOnBhcmFtIHBsb3RzX2Rlc3Q6ICAgICAgZGVzdGluYXRpb24gZm9sZGVyIG9mIHN1bW1hcnkgcGxvdHMgKHJlbGF0aXZlIHRvIGFydGlmYWN0X3BhdGgpCiAgICA6cGFyYW0gdXBkYXRlX2RhdGFzZXQ6ICB3aGVuIHRoZSB0YWJsZSBpcyBhIHJlZ2lzdGVyZWQgZGF0YXNldCB1cGRhdGUgdGhlIGNoYXJ0cyBpbi1wbGFjZQogICAgOnBhcmFtIGZyYWM6ICB3aGVuIHRoZSB0YWJsZSBoYXMgbW9yZSB0aGFuIDUwMDAgc2FtcGxlcywgdGhlIGZ1bmN0aW9uIHdpbGwgZXhlY3V0ZSBvbiByYW5kb20gZnJhYyBmcm9tIHRoZSBkYXRhCiAgICAiIiIKCiAgICBkZiA9IHRhYmxlLmFzX2RmKCkKICAgIGlmIGRmLnNoYXBlWzBdID4gNTAwMDoKICAgICAgICBkZiA9IGRmLnNhbXBsZShmcmFjPWZyYWMpCiAgICBleHRyYV9kYXRhID0ge30KCiAgICAjIGhpc3RvZ3JhbXMKICAgIHRyeToKICAgICAgICBkZltsYWJlbF9jb2x1bW5dID0gZGZbbGFiZWxfY29sdW1uXS5hcHBseShzdHIpCiAgICAgICAgZmlnID0gZmYuY3JlYXRlX3NjYXR0ZXJwbG90bWF0cml4KGRmLCBkaWFnPSdoaXN0b2dyYW0nLCBpbmRleD1sYWJlbF9jb2x1bW4sIHdpZHRoPTI1MDAsIGhlaWdodD0yNTAwKQogICAgICAgIGZpZy51cGRhdGVfbGF5b3V0KHRpdGxlX3RleHQ9JzxpPjxiPkhpc3RvZ3JhbXMgbWF0cml4PC9iPjwvaT4nKQogICAgICAgIGV4dHJhX2RhdGFbImhpc3RvZ3JhbXMiXSA9IGNvbnRleHQubG9nX2FydGlmYWN0KAogICAgICAgICAgICBQbG90bHlBcnRpZmFjdChrZXk9Imhpc3RvZ3JhbXMiLCBmaWd1cmU9ZmlnKSwKICAgICAgICAgICAgbG9jYWxfcGF0aD1mIntwbG90c19kZXN0fS9oaXN0Lmh0bWwiLAogICAgICAgICAgICBkYl9rZXk9RmFsc2UsCiAgICAgICAgKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGNvbnRleHQubG9nZ2VyLmVycm9yKGYiRmFpbGVkIHRvIGNyZWF0ZSBwYWlycGxvdCBoaXN0b2dyYW1zIGR1ZSB0bzoge2V9IikKICAgIGRmW2xhYmVsX2NvbHVtbl0gPSBkZltsYWJlbF9jb2x1bW5dLmFzdHlwZShucC5mbG9hdDY0KQoKICAgICMgdmlvbGluCiAgICB0cnk6CiAgICAgICAgZmlnID0gZ28uRmlndXJlKCkKICAgICAgICBmb3IgKGNvbHVtbk5hbWUsIGNvbHVtbkRhdGEpIGluIGRmLml0ZXJpdGVtcygpOgogICAgICAgICAgICBmaWcuYWRkX3RyYWNlKGdvLlZpb2xpbih4PVtjb2x1bW5OYW1lXSpjb2x1bW5EYXRhLnNoYXBlWzBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5PWNvbHVtbkRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9Y29sdW1uTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm94X3Zpc2libGU9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVhbmxpbmVfdmlzaWJsZT1UcnVlKSkKCiAgICAgICAgZmlnLnVwZGF0ZV9sYXlvdXQodGl0bGVfdGV4dD0nPGk+PGI+VmlvbGluIFBsb3Q8L2I+PC9pPicpCiAgICAgICAgZXh0cmFfZGF0YVsidmlvbGluIl0gPSBjb250ZXh0LmxvZ19hcnRpZmFjdCgKICAgICAgICAgICAgUGxvdGx5QXJ0aWZhY3Qoa2V5PSJ2aW9saW4iLCBmaWd1cmU9ZmlnKSwKICAgICAgICAgICAgbG9jYWxfcGF0aD1mIntwbG90c19kZXN0fS92aW9saW4uaHRtbCIsCiAgICAgICAgICAgIGRiX2tleT1GYWxzZSwKICAgICAgICApCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgY29udGV4dC5sb2dnZXIud2FybihmIkZhaWxlZCB0byBjcmVhdGUgdmlvbGluIGRpc3RyaWJ1dGlvbiBwbG90cyBkdWUgdG86IHtlfSIpCgogICAgIyBpbWJhbGFuY2UKICAgIGlmIGxhYmVsX2NvbHVtbjoKICAgICAgICBsYWJlbHNfY291bnQgPSBkZltsYWJlbF9jb2x1bW5dLnZhbHVlX2NvdW50cygpLnNvcnRfaW5kZXgoKQogICAgICAgIGRmX2xhYmVsc19jb3VudCA9IHBkLkRhdGFGcmFtZShsYWJlbHNfY291bnQpCiAgICAgICAgZGZfbGFiZWxzX2NvdW50LnJlbmFtZShjb2x1bW5zPXtsYWJlbF9jb2x1bW46ICJUb3RhbCJ9LCBpbnBsYWNlPVRydWUpCiAgICAgICAgZGZfbGFiZWxzX2NvdW50W2xhYmVsX2NvbHVtbl0gPSBsYWJlbHNfY291bnQuaW5kZXgKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZpZyA9IHB4LnBpZShkZl9sYWJlbHNfY291bnQsIG5hbWVzPWxhYmVsX2NvbHVtbiwgdmFsdWVzPSJUb3RhbCIpCiAgICAgICAgICAgIGZpZy51cGRhdGVfbGF5b3V0KHRpdGxlX3RleHQ9JzxpPjxiPkxhYmVscyBiYWxhbmNlPC9iPjwvaT4nKQogICAgICAgICAgICBleHRyYV9kYXRhWyJpbWJhbGFuY2UiXSA9IGNvbnRleHQubG9nX2FydGlmYWN0KAogICAgICAgICAgICAgICAgUGxvdGx5QXJ0aWZhY3Qoa2V5PSJpbWJhbGFuY2UiLCBmaWd1cmU9ZmlnKSwKICAgICAgICAgICAgICAgIGxvY2FsX3BhdGg9ZiJ7cGxvdHNfZGVzdH0vaW1iYWxhbmNlLmh0bWwiLAogICAgICAgICAgICApCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci53YXJuKGYiRmFpbGVkIHRvIGNyZWF0ZSBjbGFzcyBpbWJhbGFuY2UgcGxvdCBkdWUgdG86IHtlfSIpCiAgICAgICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoCiAgICAgICAgICAgIFRhYmxlQXJ0aWZhY3QoCiAgICAgICAgICAgICAgICAiaW1iYWxhbmNlLXdlaWdodHMtdmVjIiwgZGY9cGQuRGF0YUZyYW1lKHsid2VpZ2h0cyI6IGxhYmVsc19jb3VudH0pCiAgICAgICAgICAgICksCiAgICAgICAgICAgIGxvY2FsX3BhdGg9ZiJ7cGxvdHNfZGVzdH0vaW1iYWxhbmNlLXdlaWdodHMtdmVjLmNzdiIsCiAgICAgICAgICAgIGRiX2tleT1GYWxzZSwKICAgICAgICApCgogICAgIyBjb3JyZWxhdGlvbiAtIG1hdHJpeAogICAgZGYuZHJvcChbbGFiZWxfY29sdW1uXSwgYXhpcz0xLCBpbnBsYWNlPVRydWUpCiAgICB0Ymxjb3JyID0gZGYuY29ycigpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdCgKICAgICAgICBUYWJsZUFydGlmYWN0KCJjb3JyZWxhdGlvbi1tYXRyaXgiLCBkZj10Ymxjb3JyLCB2aXNpYmxlPVRydWUpLAogICAgICAgIGxvY2FsX3BhdGg9ZiJ7cGxvdHNfZGVzdH0vY29ycmVsYXRpb24tbWF0cml4LmNzdiIsCiAgICAgICAgZGJfa2V5PUZhbHNlLAogICAgKQoKICAgIHRyeToKICAgICAgICB6ID0gdGJsY29yci52YWx1ZXMudG9saXN0KCkKICAgICAgICB6X3RleHQgPSBbWyJ7Oi4yZn0iLmZvcm1hdCh5KSBmb3IgeSBpbiB4XSBmb3IgeCBpbiB6XQogICAgICAgIGZpZyA9IGZmLmNyZWF0ZV9hbm5vdGF0ZWRfaGVhdG1hcCh6LCB4PWxpc3QoZGYuY29sdW1ucyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk9bGlzdChkZi5jb2x1bW5zKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ub3RhdGlvbl90ZXh0PXpfdGV4dCwgY29sb3JzY2FsZT0nYWdzdW5zZXQnKQogICAgICAgIGZpZ1snbGF5b3V0J11bJ3lheGlzJ11bJ2F1dG9yYW5nZSddID0gInJldmVyc2VkIiAgIyBsIC0+IHIKICAgICAgICBmaWcudXBkYXRlX2xheW91dCh0aXRsZV90ZXh0PSc8aT48Yj5Db3JyZWxhdGlvbiBtYXRyaXg8L2I+PC9pPicpCiAgICAgICAgZmlnWydkYXRhJ11bMF1bJ3Nob3dzY2FsZSddID0gVHJ1ZQoKICAgICAgICBleHRyYV9kYXRhWyJjb3JyZWxhdGlvbiJdID0gY29udGV4dC5sb2dfYXJ0aWZhY3QoCiAgICAgICAgICAgIFBsb3RseUFydGlmYWN0KGtleT0iY29ycmVsYXRpb24iLCBmaWd1cmU9ZmlnKSwKICAgICAgICAgICAgbG9jYWxfcGF0aD1mIntwbG90c19kZXN0fS9jb3JyLmh0bWwiLAogICAgICAgICAgICBkYl9rZXk9RmFsc2UsCiAgICAgICAgKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGNvbnRleHQubG9nZ2VyLndhcm4oZiJGYWlsZWQgdG8gY3JlYXRlIGZlYXR1cmVzIGNvcnJlbGF0aW9uIHBsb3QgZHVlIHRvOiB7ZX0iKQogICAgaWYgdXBkYXRlX2RhdGFzZXQgYW5kIHRhYmxlLm1ldGEgYW5kIHRhYmxlLm1ldGEua2luZCA9PSAiZGF0YXNldCI6CiAgICAgICAgZnJvbSBtbHJ1bi5hcnRpZmFjdHMgaW1wb3J0IHVwZGF0ZV9kYXRhc2V0X21ldGEKCiAgICAgICAgdXBkYXRlX2RhdGFzZXRfbWV0YSh0YWJsZS5tZXRhLCBleHRyYV9kYXRhPWV4dHJhX2RhdGEpCgogICAgIyBUT0RPIDogUGxvdHMgYWNjb3JkaW5nIHRvIGNsaWVudCB3aXNoZXMgLSBsaWtlIHByZWZvcm0gaGlzdG9ncmFtIG9uIHNlbGVjdGVkIGZlYXR1cmVzLgogICAgIyBUT0RPIDogMy1EIHBsb3Qgb24gb24gc2VsZWN0ZWQgZmVhdHVyZXMuCiAgICAjIFRPRE8gOiBSZWludGVncmF0aW9uIHBsb3Qgb24gb24gc2VsZWN0ZWQgZmVhdHVyZXMuCgoK
    commands: []
    code_origin: https://github.com/davesh0812/functions.git#7c739f3e5b4c7f8e639b36ac39af81c72a220cae:/Users/davids/Projects/functions/describe/describe.py
    origin_filename: /Users/davids/Projects/functions/describe/describe.py
  entry_points:
    summarize:
      name: summarize
      doc: Summarize a table
      parameters:
      - name: context
        type: MLClientCtx
        doc: the function context
        default: ''
      - name: table
        type: DataItem
        doc: MLRun input pointing to pandas dataframe (csv/parquet file path)
        default: ''
      - name: label_column
        type: str
        doc: ground truth column label
        default: null
      - name: class_labels
        type: List[str]
        doc: label for each class in tables and plots
        default: []
      - name: plot_hist
        type: bool
        doc: (True) set this to False for large tables
        default: true
      - name: plots_dest
        type: str
        doc: destination folder of summary plots (relative to artifact_path)
        default: plots
      - name: update_dataset
        doc: when the table is a registered dataset update the charts in-place
        default: false
      - name: frac
        type: float
        doc: when the table has more than 5000 samples, the function will execute
          on random frac from the data
        default: 0.1
      outputs:
      - default: ''
      lineno: 22
  description: describe and visualizes dataset stats
  default_handler: summarize
  disable_auto_mount: false
  env: []
  priority_class_name: ''
  affinity: null
verbose: false
